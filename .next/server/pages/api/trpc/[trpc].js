"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2937:e=>{e.exports=import("@trpc/server")},6282:e=>{e.exports=import("@trpc/server/adapters/next")},9926:e=>{e.exports=import("zod")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6816:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>p,default:()=>d,routeModule:()=>s});var a=r(1802),n=r(7153),u=r(6249),o=r(7991),c=e([o]);o=(c.then?(await c)():c)[0];let d=(0,u.l)(o,"default"),p=(0,u.l)(o,"config"),s=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/trpc/[trpc]",pathname:"/api/trpc/[trpc]",bundlePath:"",filename:""},userland:o});i()}catch(e){i(e)}})},7991:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>o});var a=r(6282),n=r(9541),u=e([a,n]);[a,n]=u.then?(await u)():u;let o=a.createNextApiHandler({router:n.q,createContext:()=>({})});i()}catch(e){i(e)}})},9541:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{q:()=>s});var a=r(2937),n=r(9926),u=r(3524),o=e([a,n]);[a,n]=o.then?(await o)():o;let d=new u.PrismaClient,p=a.initTRPC.create(),s=p.router({getMovies:p.procedure.query(async()=>await d.movie.findMany()),getMovie:p.procedure.input(n.z.number()).query(async({input:e})=>await d.movie.findUnique({where:{id:e},include:{reviews:!0}})),createMovie:p.procedure.input(n.z.object({name:n.z.string(),releaseDate:n.z.string().transform(e=>new Date(e))})).mutation(async({input:e})=>await d.movie.create({data:e})),createReview:p.procedure.input(n.z.object({movieId:n.z.number(),reviewerName:n.z.string().optional(),rating:n.z.number().min(0).max(10),comments:n.z.string()})).mutation(async({input:e})=>{let t=await d.review.create({data:e});return await c(e.movieId),t}),searchReviews:p.procedure.input(n.z.string()).query(async({input:e})=>await d.review.findMany({where:{OR:[{reviewerName:{contains:e}},{comments:{contains:e}}]},include:{movie:!0}})),getMovieReviews:p.procedure.input(n.z.number()).query(async({input:e})=>await d.review.findMany({where:{movieId:e},include:{movie:!0}})),updateReview:p.procedure.input(n.z.object({id:n.z.number(),reviewerName:n.z.string().optional(),rating:n.z.number().min(0).max(10),comments:n.z.string()})).mutation(async({input:e})=>{let t=await d.review.update({where:{id:e.id},data:e});return await c(t.movieId),t}),deleteMovie:p.procedure.input(n.z.number()).mutation(async({input:e})=>(await d.review.deleteMany({where:{movieId:e}}),await d.movie.delete({where:{id:e}}))),deleteReview:p.procedure.input(n.z.number()).mutation(async({input:e})=>{let t=await d.review.delete({where:{id:e}});return await c(t.movieId),t})});async function c(e){let t=await d.review.findMany({where:{movieId:e}}),r=t.length>0?t.reduce((e,t)=>e+t.rating,0)/t.length:null;await d.movie.update({where:{id:e},data:{averageRating:r}})}i()}catch(e){i(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6816);module.exports=r})();